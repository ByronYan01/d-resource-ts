"use strict";var D=Object.defineProperty;var b=(r,e,i)=>e in r?D(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i;var h=(r,e,i)=>(b(r,typeof e!="symbol"?e+"":e,i),i);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var g=(r=>(r.Array="array",r.Tree="tree",r))(g||{}),F=(r=>(r.stop="stop",r.filter="filter",r))(F||{});const m=(r,{endFuc:e,excFuc:i})=>{const l=r.createReader(),s=()=>{l.readEntries(t=>{const a=n=>{if(!t[n]&&n===0)return e();if(!t[n])return s();i(t[n],{next:()=>{a(n+1)}})};a(0)})};s()},E=(r=!1,e={})=>{const s=Object.assign({},e,r?{webkitdirectory:!0}:{},{type:"file",visibility:"hidden"}),t=document.createElement("input");return Object.keys(s).forEach(a=>{const n=s[a];t.setAttribute(a,n)}),t.click(),new Promise((a,n)=>{t.addEventListener("change",()=>{var u;if(!t.files||((u=t.files)==null?void 0:u.length)==0)n();else{const c=Array.from(t.files);a(c)}})})},y=(r,e)=>[].slice.call(r).map(s=>e?e(s):{file:s,fullPath:s.name,name:s.name,size:s.size,type:s.type}),P=(r,e)=>{if(e===g.Array)return y(r,s=>({file:s,fullPath:s.webkitRelativePath,name:s.name,size:s.size,type:s.type}));const i=[];return[].slice.call(r).forEach(s=>{const t=s.webkitRelativePath.split("/");t.reduce((a,n,u)=>{const c=a.find(v=>v.name===n);if(c)return c.child||(c.child=[]);const d={name:n,child:[],type:"text/directory",size:0,fullPath:"",file:new File([],"",{type:"text/directory"})};return u===t.length-1&&(d.type=s.type,d.file=s,delete d.child),a.push(d),d.child},i)}),p(i[0],{path:""}),i},p=(r,{getSize:e,path:i=""})=>{if(!r.child)return r.fullPath=i+r.name,r.size=r.file.size,e?e(r):r.size||0;let l=0;return r.fullPath=i+r.name,r.file=new File([],r.fullPath,{type:"text/directory"}),r.child.forEach(s=>{l+=p(s,{getSize:e,path:r.fullPath+"/"})}),r.size=l,l},w=r=>typeof r!="number"?"":r<o(1)?r+" B":r<o(2)?(r/o(1)).toFixed(2)+" KB":r<o(3)?(r/o(2)).toFixed(2)+" MB":r<o(4)?(r/o(3)).toFixed(2)+" GB":(r/o(4)).toFixed(2)+" TB",o=r=>Math.pow(1024,r),f=()=>{};class A{constructor(e){h(this,"targetDom");h(this,"dragoverFuc");h(this,"dragleaveFuc");h(this,"beforeReadFuc");h(this,"readDataFuc");h(this,"validFuc");h(this,"filterFuc");h(this,"mode");h(this,"onlyFile");h(this,"bindFuc");h(this,"targetOverFlag");this.targetDom=e.targetDom,this.dragoverFuc=e.dragoverFuc||f,this.dragleaveFuc=e.dragleaveFuc||f,this.beforeReadFuc=e.beforeReadFuc,this.readDataFuc=e.readDataFuc||f,this.validFuc=e.validFuc,this.filterFuc=e.filterFuc,this.mode=e.mode||g.Array,this.onlyFile=e.onlyFile||!1,this.bindFuc={DragFuc:this.DragFuc.bind(this),getDrapFile:this.getDrapFile.bind(this),pasteFuc:this.pasteFuc.bind(this),mouseFuc:this.mouseFuc.bind(this)},this.targetOverFlag=!1,this.init()}init(){this.targetDom&&(this.targetDom.addEventListener("mouseenter",this.bindFuc.mouseFuc,!1),this.targetDom.addEventListener("mouseleave",this.bindFuc.mouseFuc,!1),document.addEventListener("paste",this.bindFuc.pasteFuc,!1),this.targetDom.addEventListener("dragover",this.bindFuc.DragFuc,!1),this.targetDom.addEventListener("dragleave",this.bindFuc.DragFuc,!1),this.targetDom.addEventListener("drop",this.bindFuc.getDrapFile,!1))}destroy(){this.bindFuc&&(this.targetDom.removeEventListener("dragover",this.bindFuc.DragFuc,!1),this.targetDom.removeEventListener("dragleave",this.bindFuc.DragFuc,!1),this.targetDom.removeEventListener("drop",this.bindFuc.getDrapFile,!1),this.bindFuc={})}mouseFuc(e){e.type==="mouseenter"?this.targetOverFlag=!0:this.targetOverFlag=!1}DragFuc(e){e.stopPropagation(),e.preventDefault(),this[e.type==="dragover"?"dragoverFuc":"dragleaveFuc"].call(e.target)}getDrapFile(e){this.DragFuc(e),this.addDataTransfer(e.dataTransfer)}pasteFuc(e){if(!this.targetOverFlag)return;const i=document.activeElement;i&&/textarea|input/i.test(i.nodeName)||this.addDataTransfer(e.clipboardData)}errHanlder(e,i){(e==null?void 0:e.message)!==F.stop&&i&&i()}addDataTransfer(e){var l;let i=!0;if(typeof this.beforeReadFuc=="function"&&(i=this.beforeReadFuc()),i&&((l=e==null?void 0:e.items)!=null&&l.length)){const s=[];for(let t=0;t<e.items.length;t++){const a=e.items[t];let n;n=a.webkitGetAsEntry(),s.push(n)}return this.getContent(s).then(t=>{typeof this.readDataFuc=="function"&&this.readDataFuc(t)},t=>{this.errHanlder(t)})}}getContent(e){return new Promise((i,l)=>{const s=[],t=a=>{const n=e[a];if(!n)return i(s);const u=this.mode==="tree"?"getFileSystemEntryTree":"getFileSystemEntryArray";this[u](n,"").then(function(c){s.push(...c),t(a+1)},c=>{this.errHanlder(c)})};t(0)})}ifPushValid(e){return typeof this.filterFuc=="function"?this.filterFuc(e):!0}pushItem(e,i){return this.ifPushValid(i)?(e.push(i),i):null}entryFileHandler(e,{resolve:i,reject:l},s){const t=[];e.file(a=>{const n=s(a);if(typeof this.validFuc=="function"){if(!this.validFuc(n))return l(new Error(F.stop));this.pushItem(t,n),i(t)}else this.pushItem(t,n),i(t)})}getFileSystemEntryTree(e,i=""){return new Promise((l,s)=>{if(!e){l([]);return}if(e.isFile){this.entryFileHandler(e,{resolve:l,reject:s},t=>({size:t.size,fullPath:i+t.name,name:t.name,type:t.type,file:t}));return}if(e.isDirectory){let t=e;const a={fullPath:i+t.name,name:t.name,size:0,type:"text/directory",file:new File([],i+t.name,{type:"text/directory"}),child:[]};if(!this.ifPushValid(a))return s(new Error(F.filter));m(t,{endFuc:()=>(Array.isArray(a.child)&&(a.size=a.child.reduce((n,u)=>n+((u==null?void 0:u.size)||(u==null?void 0:u.size)),0)),l([a])),excFuc:(n,{next:u})=>{this.getFileSystemEntryTree(n,i+t.name+"/").then(c=>{Array.isArray(a.child)&&a.child.push(...c),u()},c=>{this.errHanlder(c,()=>{u()})})}});return}l([])})}getFileSystemEntryArray(e,i=""){return new Promise((l,s)=>{if(!e){l([]);return}if(e.isFile){this.entryFileHandler(e,{resolve:l,reject:s},t=>({size:t.size,fullPath:i+t.name,name:t.name,type:t.type,file:t}));return}if(e.isDirectory){let t=e;const a=[],n={fullPath:i+t.name,name:t.name,size:0,type:"text/directory",file:new File([],i+t.name,{type:"text/directory"})};if(!this.onlyFile&&!this.pushItem(a,n))return s(new Error(F.filter));m(t,{endFuc:()=>(this.onlyFile||(a[0].size=a.reduce((u,c)=>u+((c==null?void 0:c.size)||0),0)),l(a)),excFuc:(u,{next:c})=>{this.getFileSystemEntryArray(u,i+t.name+"/").then(d=>{console.log("results===",d),a.push(...d),c()},d=>{this.errHanlder(d,()=>{c()})})}});return}l([])})}}exports.ResHandle=A;exports.dirReadEntry=m;exports.filterSize=w;exports.selectFileChange=y;exports.selectFolderChange=P;exports.selectResource=E;
